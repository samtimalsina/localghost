<?php

function localghost_menu() {
  $items['admin/config/localghost/configure'] = array(
    'title' => 'Local Ghost',
    'description' => 'Configure LocalGhost',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('localghost_configure_form'),
    'access arguments' => array('configure localghost'),
    'file' => 'localghost.admin.inc',
  );
  return $items;
}

function localghost_page_alter(&$page) {
  if (variable_get('enable_localghost') !== 1) return;
  $page_array = $page;
  $path = request_path();
  if(empty($path)) $path = 'index';
  $html = drupal_render($page_array);
  $html_file = file_save_data($html, 'public://localghost/' . $path . '.html', FILE_EXISTS_REPLACE);
}

function localghost_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id === 'system_file_system_settings') {
    $form['file_localghost_path'] = array(
      '#type' => 'textfield',
      '#title' => t('LocalGhost file system path'),
      '#default_value' => variable_get('file_localghost_path', ''),
      '#maxlength' => 255,
      '#description' => t('An existing local file system path for static files generated by LocalGhost. It should be writable by Drupal and not accessible over the web. Configure the deployment settings in the module.'),
      '#after_build' => array('system_check_directory'),
    );
  }
}
